#!/bin/bash

# ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ
CURRENT_DATE=$(date +"%d.%m.%Y")

# Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð²
COMMIT_COUNT=$(git rev-list --count HEAD)

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¼ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ¾Ð¼
cat > /tmp/progress_section.md << EOL
## ðŸ“Š ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ
- ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ: $CURRENT_DATE
- Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²: 3
- ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð²: $COMMIT_COUNT
EOL

# Ð•ÑÐ»Ð¸ README.md ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚, Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÐµÐºÑ†Ð¸ÑŽ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ°
if [ -f README.md ]; then
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ README
    TEMP_README=$(mktemp)
    
    # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ awk Ð´Ð»Ñ Ð·Ð°Ð¼ÐµÐ½Ñ‹ ÑÐµÐºÑ†Ð¸Ð¸ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ°
    awk '
    /^## ðŸ“Š ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ$/ { 
        skip=1; 
        # Ð’ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð¾Ð²ÑƒÑŽ ÑÐµÐºÑ†Ð¸ÑŽ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ°
        system("cat /tmp/progress_section.md")
        next 
    }
    /^## [^#]/ && skip { 
        skip=0 
    }
    !skip { 
        print 
    }
    ' README.md > "$TEMP_README"
    
    # Ð•ÑÐ»Ð¸ ÑÐµÐºÑ†Ð¸Ñ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ° Ð½Ðµ Ð±Ñ‹Ð»Ð° Ð½Ð°Ð¹Ð´ÐµÐ½Ð°, Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐµÐµ Ð² ÐºÐ¾Ð½ÐµÑ†
    if ! grep -q "## ðŸ“Š ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ" README.md; then
        echo "" >> "$TEMP_README"
        cat /tmp/progress_section.md >> "$TEMP_README"
    fi
    
    # Ð—Ð°Ð¼ÐµÐ½ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ README Ð½Ð¾Ð²Ñ‹Ð¼
    mv "$TEMP_README" README.md
    echo "README.md updated while preserving manual changes!"
else
    # Ð•ÑÐ»Ð¸ README Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚, ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹
    cat > README.md << EOL
# ðŸŒ¼ Ð’ÐµÐ±-Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ Ð Ð¾Ð¼Ð°ÑˆÐºÐ¾Ð¹

ÐœÐ¾Ð¹ ÑƒÑ‡ÐµÐ±Ð½Ñ‹Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð´Ð»Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´-Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸.

## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²

### Ð£Ñ€Ð¾Ðº 1: ÐžÑÐ½Ð¾Ð²Ñ‹ HTML Ð¸ Git
- [ðŸ‘¨â€ðŸ’» Ð’Ð¸Ð·Ð¸Ñ‚ÐºÐ°](lesson-01/cutaway/) - ÐŸÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° "Ðž ÑÐµÐ±Ðµ"
- [ðŸ“… Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð´Ð½Ñ](lesson-01/daily-schedule/) - Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡  
- [ðŸ Ð ÐµÑ†ÐµÐ¿Ñ‚ Ð¿ÐµÐ»ÑŒÐ¼ÐµÐ½ÐµÐ¹](lesson-01/recipe-pelmeni/) - Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ñ Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð¾Ð¼

## ðŸš€ ÐšÐ°Ðº Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹
1. ÐžÑ‚ÐºÑ€Ð¾Ð¹ Ð¿Ð°Ð¿ÐºÑƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð² VS Code
2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ "Live Server"
3. ÐšÐ»Ð¸ÐºÐ½Ð¸ Ð¿Ñ€Ð°Ð²Ð¾Ð¹ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ Ð½Ð° index.html â†’ "Open with Live Server"

$(cat /tmp/progress_section.md)
EOL
    echo "README.md created from scratch!"
fi

# Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
rm -f /tmp/progress_section.md
